---
title: "Output"
output:
  pdf_document: 
    fig_caption: yes
    highlight: tango
  html_document:
    df_print: paged
vignette: >
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# Output data

## Output of MaxWiK algorithm

### Voronoi matrix

The Voronoi matrix is a matrix of information about Voronoi sites for each tree in the isolation forest algorithm (rows - trees, columns - Voronoi sites IDs) for parameters data set:

```{r, include = TRUE}
cols = c(1:4, 9:16)
df = as.data.frame( MaxWiK::Data.2D$ABC$Matrix.Voronoi[ 1:4, cols ] )
names( df ) = cols
print( df )

```

### The kernel mean embedding

The kernel_mean_embedding is a kernel mean embedding of observation point in the form of the vector of IDs of the Voronoi sites in the Voronoi matrix for each tree:

```{r, include = TRUE}
MaxWiK::Data.2D$ABC$result.MaxWiK$kernel_mean_embedding

```

In this example, the kernel mean embedding has 8 IDs for 8 trees where each ID is a column number of Voronoi matrix, tree ID corresponds to the row of Voronoi matrix.

### Similarity

The similarity vector is the similarity measured by using isolation kernel, and it shows how each data point similar to the observation one, for example for the first points:

```{r, include = TRUE}
MaxWiK::Data.2D$ABC$result.MaxWiK$similarity[1:20]

```

### Matrix_iKernel

The Matrix_iKernel is the matrix of Voronoi sites for each data point in the form of Hilbert representation, for example, for the first 5 data points:

```{r, include = TRUE}
MaxWiK::Data.2D$ABC$result.MaxWiK$Matrix_iKernel[1:4,]

```

### Other data

Other data like hyperparameters, $t$, $\psi$, etc., can be found in the description of the related functions, or intuitively understandable.

## Output of metasampling algorithm

The metasampling algorithm has several features, because it iteratively generates the data points in the space of parameters and selects the points with higher similarity. The result has the next issues:

-   input.parameters is just all the input parameters of the function **meta_sampling()**;

-   iteration is a number of iterations during metasampling;

-   iKernelABC is the list of output from **get.MaxWiK()** function;

-   par.best is the best parameter found at the end of metasampling;

-   sim.best is the similarity corresponing to the par.best point;

-   spiderweb is the list of the generated data points for each iteration, the name 'spiderweb' used because of algorithmic feature which generates data points closer and cloaser to the observation like spider makes a web.

## Output of sampling algorithm

The functions sampler_MaxWiK() and sampler_MaxWiK_parallel() return the list of the next objects:

-   results - the data frame of results of the sampling algorithm which includes the generated parameters, simulated output data, similarities (sim), mean squared error (mse), comments (com), and simulation IDs (sim_ID):

```{r, echo=FALSE, include = TRUE}
str(MaxWiK::Data.2D$sampling$MaxWiK$results)
```

-   best - the data frame of the most accurate simulation:

```{r, echo=FALSE, include = TRUE}
str(MaxWiK::Data.2D$sampling$MaxWiK$best)
```

-   time - the time of sampling in seconds;

-   n_simulations - the total number of simulations;

-   number_of_iterations - the number of iterations, each iteration includes several simulations, and number of simulations in each iteration depends on hyperparameters.

So, using results data frame, one can plot MSE of the sampling:

```{r, echo=FALSE, include = TRUE, fig.height=3, fig.width=4.5}
library('ggplot2')
th = MaxWiK::Data.2D$sampling$theme.ggplot
th$axis.title.x$size = th$axis.title.y$size = 12
th$axis.text$size = 10
smpl_1 = MaxWiK::Data.2D$sampling$MaxWiK
MSE  =  data.frame( x = smpl_1$results$sim_ID, y = smpl_1$results$mse )
ggplot(data = MSE, aes( x, y ) ) + 
    geom_line( linewidth = 0.7 )  +  scale_y_log10() + 
    geom_smooth(method = "lm", alpha = .5, formula= y~x ) + 
    ylab("Mean Squared Error") + xlab("Number of simulations") + th
```

Also, the data generation can be visualized like for 2D example:

```{r, echo=FALSE, include = TRUE, fig.height=3, fig.width=4.5}
library('ggplot2')
th = MaxWiK::Data.2D$sampling$theme.ggplot
th$axis.title.x$size = th$axis.title.y$size = 12
th$axis.text$size = 10
smpl_1 = MaxWiK::Data.2D$sampling$MaxWiK
X12 = data.frame( i  = smpl_1$results$sim_ID, 
                  x1 = smpl_1$results$par.sim.X1,  
                  x2 = smpl_1$results$par.sim.X2 )
ggplot(data = X12, aes( i ) ) + 
    geom_line(aes(y = x1 ), linewidth = 0.5 ) +
    geom_line(aes(y = x2 ), linewidth = 0.5 ) + 
    geom_hline( aes(yintercept= obs$x0[1]),   
                color='red', linetype=2, linewidth=0.4) +
    geom_hline( aes(yintercept= obs$x0[2]),   
                color='red', linetype=2, linewidth=0.4) +
    ylab("Parameters X1 and X2") + xlab("Number of simulations") + th
```

Here the red dashed lines are truth values of the observation.

## Output of predictor

The output format of predictor is almost same as for metasampling algorithm, for details, please, see manual.
